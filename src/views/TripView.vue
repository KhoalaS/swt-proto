<script setup>
import { ref, onMounted } from "vue";
import iconUrl from "../assets/marker.svg";
const props = defineProps({
  time: {
    type: String,
  },
  dep: {
    type: String,
  },
  dest: {
    type: String,
  },
});

const map = ref(null);
const date = new Date(props.time);
date.setHours(14);
date.setMinutes(39);
let m = null;

const latlngs = getPath();

const pins = [
  { name: "Trier, Porta Nigra", coords: "6.64275,49.75918" },
  {
    name: "Kürenz, Kohlenstraße",
    coords: "6.68507,49.75097",
  },
];

onMounted(() => {
  m = L.map(map.value).setView([49.75667, 6.64139], 13);
  L.tileLayer(
    "https://tiles.stadiamaps.com/tiles/osm_bright/{z}/{x}/{y}{r}.png",
    {
      maxZoom: 19,
      minZoom: 10,
      attribution:
        '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
    }
  ).addTo(m);

  var myIcon = L.icon({
    iconUrl: iconUrl,
    iconAnchor: [12, 41],
    iconSize: [25, 41],
    popupAnchor: [0, -30],
  });

  pins.forEach((elem, i) => {
    const coords = elem.coords.split(",");
    const marker = L.marker([coords[1], coords[0]], { icon: myIcon })
      .addTo(m)
      .bindPopup(
        `<p>${
          elem.name
        }</p><div class="flex justify-center gap-4 my-2"><button class="dark:text-gray rounded px-1 py-[2px] border-2 border-green">${
          i == 0 ? "Start" : "Ziel"
        }</button></div>`
      );
  });

  var polyline = L.polyline(latlngs, { color: "purple" }).addTo(m);
  m.fitBounds(polyline.getBounds());

  m.on("zoom", () => {
    console.log(m.getZoom());
    //TODO Marker einbinden ab ZoomLevel X
  });
});
function zoomTo(index) {
  let coords = pins[index].coords.split(",");
  m.setView([coords[1], coords[0]], 13);
}

function getPath() {
  const s =
    "6.64402,49.75931 6.64408,49.75934 6.64417,49.75940 6.64432,49.75946 6.64437,49.75948 6.64451,49.75957 6.64462,49.75966 6.64464,49.75968 6.64466,49.75970 6.64468,49.75972 6.64471,49.75978 6.64482,49.75972 6.64529,49.75939 6.64536,49.75934 6.64553,49.75920 6.64591,49.75896 6.64601,49.75891 6.64624,49.75882 6.64708,49.75848 6.64719,49.75844 6.64810,49.75809 6.64840,49.75799 6.64862,49.75795 6.64872,49.75794 6.64880,49.75795 6.64903,49.75795 6.64912,49.75794 6.64917,49.75794 6.64925,49.75791 6.64947,49.75783 6.64978,49.75772 6.64982,49.75771 6.64991,49.75768 6.64998,49.75766 6.65006,49.75765 6.65015,49.75762 6.65024,49.75760 6.65034,49.75758 6.65061,49.75752 6.65100,49.75736 6.65122,49.75727 6.65125,49.75726 6.65128,49.75726 6.65131,49.75725 6.65135,49.75725 6.65144,49.75725 6.65148,49.75725 6.65157,49.75725 6.65180,49.75725 6.65188,49.75725 6.65195,49.75726 6.65203,49.75730 6.65207,49.75733 6.65213,49.75740 6.65225,49.75753 6.65230,49.75757 6.65241,49.75768 6.65241,49.75768 6.65245,49.75773 6.65265,49.75793 6.65276,49.75797 6.65284,49.75801 6.65291,49.75807 6.65295,49.75811 6.65307,49.75822 6.65312,49.75827 6.65329,49.75844 6.65356,49.75871 6.65373,49.75888 6.65433,49.75948 6.65458,49.75972 6.65475,49.75988 6.65530,49.76042 6.65550,49.76060 6.65561,49.76069 6.65561,49.76069 6.65565,49.76073 6.65583,49.76088 6.65589,49.76093 6.65597,49.76101 6.65612,49.76091 6.65666,49.76055 6.65717,49.76015 6.65724,49.76010 6.65741,49.75998 6.65777,49.75973 6.65782,49.75969 6.65806,49.75952 6.65818,49.75943 6.65829,49.75934 6.65829,49.75934 6.65832,49.75932 6.65843,49.75924 6.65852,49.75918 6.65865,49.75926 6.65890,49.75941 6.65901,49.75946 6.65929,49.75964 6.65949,49.75973 6.65993,49.75992 6.66016,49.76000 6.66028,49.76006 6.66084,49.76034 6.66090,49.76037 6.66115,49.76049 6.66126,49.76054 6.66126,49.76054 6.66127,49.76054 6.66149,49.76063 6.66166,49.76070 6.66185,49.76077 6.66212,49.76086 6.66247,49.76093 6.66287,49.76110 6.66340,49.76134 6.66358,49.76145 6.66368,49.76151 6.66391,49.76166 6.66396,49.76170 6.66415,49.76182 6.66423,49.76187 6.66423,49.76187 6.66432,49.76192 6.66452,49.76205 6.66497,49.76234 6.66510,49.76241 6.66552,49.76262 6.66587,49.76278 6.66628,49.76297 6.66650,49.76307 6.66669,49.76315 6.66669,49.76315 6.66672,49.76316 6.66696,49.76327 6.66723,49.76337 6.66734,49.76341 6.66744,49.76343 6.66751,49.76346 6.66765,49.76354 6.66770,49.76360 6.66788,49.76360 6.66804,49.76360 6.66821,49.76358 6.66827,49.76358 6.66831,49.76357 6.66834,49.76357 6.66842,49.76355 6.66848,49.76354 6.66853,49.76353 6.66860,49.76350 6.66862,49.76346 6.66867,49.76343 6.66875,49.76339 6.66890,49.76327 6.66899,49.76319 6.66903,49.76318 6.66906,49.76314 6.66916,49.76302 6.66921,49.76296 6.66942,49.76270 6.66955,49.76254 6.66967,49.76239 6.66990,49.76213 6.67001,49.76203 6.67013,49.76196 6.67035,49.76187 6.67057,49.76179 6.67072,49.76172 6.67095,49.76163 6.67122,49.76152 6.67129,49.76149 6.67164,49.76134 6.67184,49.76125 6.67191,49.76121 6.67191,49.76121 6.67208,49.76112 6.67221,49.76104 6.67251,49.76086 6.67268,49.76075 6.67306,49.76050 6.67358,49.76018 6.67380,49.76006 6.67393,49.76000 6.67404,49.75994 6.67414,49.75991 6.67414,49.75991 6.67415,49.75990 6.67425,49.75987 6.67440,49.75983 6.67459,49.75979 6.67489,49.75974 6.67532,49.75968 6.67570,49.75962 6.67611,49.75958 6.67771,49.75938 6.67844,49.75925 6.67912,49.75909 6.67933,49.75904 6.67957,49.75896 6.67961,49.75894 6.67961,49.75894 6.67971,49.75890 6.68000,49.75876 6.68018,49.75866 6.68030,49.75858 6.68046,49.75847 6.68076,49.75826 6.68092,49.75813 6.68101,49.75805 6.68105,49.75800 6.68109,49.75795 6.68113,49.75791 6.68116,49.75785 6.68118,49.75778 6.68118,49.75773 6.68119,49.75768 6.68117,49.75759 6.68111,49.75744 6.68107,49.75733 6.68103,49.75720 6.68099,49.75708 6.68098,49.75697 6.68098,49.75683 6.68103,49.75663 6.68112,49.75643 6.68140,49.75607 6.68159,49.75581 6.68193,49.75535 6.68207,49.75515 6.68217,49.75499 6.68228,49.75480 6.68235,49.75466 6.68240,49.75455 6.68243,49.75445 6.68250,49.75413 6.68252,49.75404 6.68255,49.75386 6.68257,49.75380 6.68260,49.75366 6.68260,49.75366 6.68261,49.75356 6.68263,49.75351 6.68267,49.75342 6.68272,49.75335 6.68282,49.75321 6.68298,49.75303 6.68319,49.75280 6.68331,49.75266 6.68336,49.75260 6.68337,49.75247 6.68338,49.75236 6.68338,49.75222 6.68338,49.75220 6.68337,49.75218 6.68336,49.75217 6.68336,49.75215 6.68335,49.75214 6.68333,49.75213 6.68331,49.75212 6.68329,49.75212 6.68327,49.75211 6.68325,49.75210 6.68323,49.75209 6.68322,49.75208 6.68320,49.75206 6.68319,49.75205 6.68318,49.75204 6.68317,49.75202 6.68317,49.75201 6.68317,49.75199 6.68317,49.75198 6.68317,49.75196 6.68317,49.75194 6.68318,49.75193 6.68318,49.75192 6.68319,49.75190 6.68320,49.75189 6.68322,49.75188 6.68323,49.75187 6.68325,49.75186 6.68326,49.75185 6.68328,49.75184 6.68331,49.75183 6.68333,49.75183 6.68335,49.75182 6.68338,49.75182 6.68340,49.75182 6.68342,49.75181 6.68345,49.75182 6.68347,49.75182 6.68350,49.75182 6.68352,49.75183 6.68354,49.75184 6.68357,49.75184 6.68360,49.75184 6.68363,49.75184 6.68365,49.75184 6.68367,49.75183 6.68370,49.75183 6.68373,49.75182 6.68390,49.75174 6.68411,49.75166 6.68417,49.75163 6.68428,49.75155 6.68438,49.75146 6.68461,49.75126 6.68471,49.75118 6.68484,49.75106 6.68498,49.75093 6.68511,49.75081 6.68534,49.75059 6.68537,49.75056";

  const split = s.split(" ");

  let latLong = [];

  split.forEach((elem) => {
    const coords = elem.split(",");
    latLong.push([coords[1], coords[0]]);
  });
  return latLong;
}
</script>

<template>
  <main class="p-4 md:flex md:flex-row-reverse md:gap-4">
    <div
      class="z-0 h-[336px] md:h-[720px] md:w-full border-2 border-green rounded"
      ref="map"
      id="map"
    ></div>
    <div class="md:hidden h-[2px] bg-dark-blue my-4 rounded"></div>
    <div class="flex flex-col text-lg">
      <p>
        Start:
        <a
          @click="zoomTo(0)"
          class="text-blue hover:cursor-pointer underline"
          >{{ props.dep }}</a
        >
      </p>
      <p>Linie 3</p>
      <p>Richtung Weidengraben</p>
      <p>
        geplante Zeit:
        {{
          date.toLocaleString(undefined, {
            day: "2-digit",
            month: "2-digit",
            year: "numeric",
            hour: "2-digit",
            minute: "2-digit",
          })
        }}
      </p>
      <p class="font-bold">
        Echtzeit:
        {{
          date.toLocaleString(undefined, {
            day: "2-digit",
            month: "2-digit",
            year: "numeric",
            hour: "2-digit",
            minute: "2-digit",
          })
        }}
      </p>
      <p>
        Ziel:
        <a
          @click="zoomTo(1)"
          class="text-blue hover:cursor-pointer underline"
          >{{ props.dest }}</a
        >
      </p>
    </div>
  </main>
</template>

<style scoped>
p {
  white-space: nowrap;
}
</style>
